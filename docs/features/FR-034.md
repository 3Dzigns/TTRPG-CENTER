# FR-034 — Ingestion Process Observability Dashboard

## Title
**Real-Time Ingestion Observability and Graphical Dashboard**

## Description
As an **Admin user**, I want a graphical interface in the Ingestion Console that shows **real-time ingestion progress** across all passes (Parse/Chunk, Enrich, Graph Compile), so that I can clearly see what is happening at any point in the ingestion process, track counts of records created/stored, and identify/correct errors early.

## User Stories

### US-034.1 — Job Selection & Live Status
**As** an Admin  
**I want** to select any ingestion job from the Ingestion Console and see its detailed status in real time  
**So that** I can monitor current progress and catch failures quickly.

**Acceptance Criteria**
- Ingestion Console lists all jobs with a “View Status” button.
- Clicking opens a real-time status panel (via SSE/WebSocket).
- Panel shows per-pass progress bars (`Pass A`, `Pass B`, `Pass C`).
- Errors surface immediately with job_id, pass, and reason.

---

### US-034.2 — Graphs & Metrics
**As** an Admin  
**I want** graphical charts showing records processed by source and total  
**So that** I can quickly gauge ingestion throughput and outcomes.

**Acceptance Criteria**
- Line/Bar charts: records processed per pass, per source.
- Pie/Stacked charts: success vs failed vs skipped records.
- Metrics update live: counts, processing rate, average latency.
- Charts scoped to the selected job (job_id).

---

### US-034.3 — Error & Alert Visibility
**As** an Admin  
**I want** surfaced alerts for anomalies or failed passes  
**So that** I can investigate and restart jobs before downstream effects.

**Acceptance Criteria**
- Alerts highlight red in the dashboard.
- Clicking alert expands error details (stack trace, failing chunk id).
- Option to download job artifacts/log bundle from the same panel.

---

### US-034.4 — Historical Trends
**As** an Admin  
**I want** the ability to compare current ingestion metrics against historical runs  
**So that** I can spot regressions in performance or data quality.

**Acceptance Criteria**
- Historical jobs selectable in dashboard.
- Side-by-side view of per-pass counts and average throughput.
- Stored metrics are pulled from existing `manifest.json` artifacts.

---

## Test Cases

### Unit Tests
- Verify job selection opens correct WebSocket/SSE channel.
- Validate metrics JSON schema matches `{pass, count, status, timestamp}`.
- Ensure chart components render correctly with mock data.
- Progress bar components update status fields as expected.

### Functional Tests
- Run fixture ingestion job → dashboard updates counts in real time.
- Inject error in Pass B → error surfaces immediately in UI.
- User clicks alert → expanded error details are shown.
- Historical job metrics load from `manifest.json` and render side-by-side.

### Regression Tests
- Baseline fixture jobs (short/medium PDF) always display stable counts.
- Golden snapshot for metrics schema and chart layout remains consistent across releases.
- Historical job comparison continues to render correctly after upgrades.

### Security Tests
- WebSocket/SSE endpoints tenant-scoped (DEV/TEST/PROD isolation enforced).
- Sensitive error details (tokens, secrets) redacted from dashboard views.
- Rate limiting applied on status updates to prevent flooding or denial-of-service.
- Authorization enforced — only Admins can access ingestion observability view.

---

## Dependencies
- **Phase 1 (Ingestion)**: Passes already produce artifacts (`passA_chunks.json`, etc.) and `manifest.json`.
- **Phase 4 (Admin UI)**: Ingestion Console requires a new “Observability” panel.
- **Phase 6 (Testing)**: Error conditions should automatically create bug bundles.

---

✅ **Definition of Done (FR-034)**
- Admin UI provides live ingestion observability with progress bars, charts, and error alerts.
- Metrics update in real time via SSE/WebSocket.
- Historical job comparisons supported with manifest-based data.
- All unit, functional, regression, and security tests green in CI.
