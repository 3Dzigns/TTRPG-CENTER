# FR-033 — Unify Ad-Hoc & Selective Ingestion to Full Lane A Pipeline

## Summary
Ensure **Ad-hoc** and **Ingest Selected** jobs both run the **full multi-pass Lane A ingestion pipeline**, with proper logging, job state updates, and source scoping.

## Goals
1. Fix bug where Ad-hoc jobs stall at creation with no worker execution.
2. Standardize ingestion execution across nightly, ad-hoc, and selective jobs.
3. Allow Admins to run ingestion selectively on chosen sources from the console.
4. Improve observability with phase-by-phase logs and job status updates.

## User Stories

### US-033-1: Admin Ad-Hoc Execution
**As an Admin**  
I want to run an ad-hoc job that executes Pass A → B → C  
**So that** ingestion results are immediately available without waiting for nightly.

### US-033-2: Selective Source Execution
**As an Admin**  
I want to run ingestion only for selected sources  
**So that** I can reprocess specific documents as needed.

### US-033-3: Unified Job Runner
**As a Developer**  
I want a single ingestion runner function used by nightly, ad-hoc, and selective jobs  
**So that** ingestion behavior is consistent across job types.

### US-033-4: Progress Visibility
**As an Admin**  
I want detailed logs and status per phase (A/B/C)  
**So that** I can see ingestion health and troubleshoot failures.

## Acceptance Criteria
- Ad-hoc jobs advance through Pass A/B/C automatically.
- Selective jobs process only chosen sources.
- Logs show phase start/finish with counts & checksums.
- Job status transitions: `pending → running → completed/failed`.
- Artifacts stored under `artifacts/ingest/{ENV}/{JOB_ID}/`.

## Test Cases
- Start Ad-hoc job → log shows Pass A–C progression; job ends `completed`.
- Start Selective job on 2 sources → only those appear in manifest/artifacts.
- Fail Pass B → job ends `failed`, downstream passes skipped.
- Re-run Ad-hoc with unchanged sources → cached phases skipped unless forced.
- Concurrency test: two jobs on same source trigger lock or queueing.

## Security
- Admin-only endpoints for triggering jobs.
- Sanitized job IDs and source names.
- Prevent cross-env data leakage (DEV vs TEST vs PROD).

## Exit Criteria
- All ingestion job types (nightly, ad-hoc, selective) run the same Lane A pipeline.
- Jobs show correct real-time progress and status in Admin UI.
- Unit, functional, regression, and security tests pass in CI.
