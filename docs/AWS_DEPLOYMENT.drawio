<mxfile host="app.diagrams.net" modified="2025-09-06T00:00:00.000Z" agent="Mozilla/5.0" version="22.0.3">
  <diagram id="aws1" name="AWS Deployment">
    <mxGraphModel dx="1600" dy="1200" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1920" pageHeight="1200" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>

        <!-- Route 53 / CloudFront / WAF -->
        <mxCell id="10" value="Route 53 (DNS)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="60" y="60" width="160" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="11" value="CloudFront + AWS WAF" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#cfe2f3;strokeColor=#6d9eeb" vertex="1" parent="1">
          <mxGeometry x="260" y="60" width="200" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="12" value="ACM (TLS Certs)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#c9daf8;strokeColor=#3d85c6" vertex="1" parent="1">
          <mxGeometry x="260" y="110" width="200" height="30" as="geometry"/>
        </mxCell>

        <!-- VPC box -->
        <mxCell id="20" value="VPC" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#999999;dashed=1" vertex="1" parent="1">
          <mxGeometry x="60" y="160" width="1600" height="900" as="geometry"/>
        </mxCell>

        <!-- Public Subnets -->
        <mxCell id="21" value="Public Subnets" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656" vertex="1" parent="20">
          <mxGeometry x="20" y="20" width="1560" height="150" as="geometry"/>
        </mxCell>
        <mxCell id="30" value="Application Load Balancer (ALB)\nPath-based routing" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontStyle=1" vertex="1" parent="21">
          <mxGeometry x="40" y="40" width="320" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="31" value="NAT Gateway" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f9cb9c;strokeColor=#e69138" vertex="1" parent="21">
          <mxGeometry x="390" y="60" width="140" height="40" as="geometry"/>
        </mxCell>

        <!-- Private Subnets -->
        <mxCell id="22" value="Private Subnets" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d9ead3;strokeColor=#6aa84f" vertex="1" parent="20">
          <mxGeometry x="20" y="190" width="1560" height="670" as="geometry"/>
        </mxCell>

        <!-- ECS Services (Fargate) -->
        <mxCell id="40" value="ECS Fargate Service\nCore API (src_common/app.py)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#cfe2f3;strokeColor=#6d9eeb" vertex="1" parent="22">
          <mxGeometry x="40" y="40" width="260" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="41" value="ECS Fargate Service\nUser UI (app_user.py)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#cfe2f3;strokeColor=#6d9eeb" vertex="1" parent="22">
          <mxGeometry x="320" y="40" width="260" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="42" value="ECS Fargate Service\nAdmin UI (app_admin.py)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#cfe2f3;strokeColor=#6d9eeb" vertex="1" parent="22">
          <mxGeometry x="600" y="40" width="260" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="43" value="ECS Fargate Service\nFeedback (app_feedback.py)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#cfe2f3;strokeColor=#6d9eeb" vertex="1" parent="22">
          <mxGeometry x="880" y="40" width="260" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="44" value="ECS Fargate Service\nRequirements (app_requirements.py)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#cfe2f3;strokeColor=#6d9eeb" vertex="1" parent="22">
          <mxGeometry x="1160" y="40" width="300" height="70" as="geometry"/>
        </mxCell>

        <!-- Shared Services in Private Subnets -->
        <mxCell id="50" value="Secrets Manager" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6" vertex="1" parent="22">
          <mxGeometry x="40" y="140" width="200" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="51" value="SSM Parameter Store" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6" vertex="1" parent="22">
          <mxGeometry x="260" y="140" width="200" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="52" value="CloudWatch Logs" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6" vertex="1" parent="22">
          <mxGeometry x="480" y="140" width="200" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="53" value="EFS (shared)\n/var/app/artifacts, /var/app/auth.db" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e2efda;strokeColor=#93c47d" vertex="1" parent="22">
          <mxGeometry x="700" y="140" width="260" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="54" value="S3 (artifacts-dev/test/prod)\nOption B: store artifacts & feedback outputs" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656" vertex="1" parent="22">
          <mxGeometry x="980" y="140" width="320" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="55" value="S3 (static assets)\noptional offload for UI static" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656" vertex="1" parent="22">
          <mxGeometry x="1320" y="140" width="240" height="70" as="geometry"/>
        </mxCell>

        <!-- External Services -->
        <mxCell id="60" value="OpenAI API (Internet)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f4cccc;strokeColor=#cc0000" vertex="1" parent="20">
          <mxGeometry x="1320" y="40" width="240" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="61" value="Astra DB (Serverless)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f4cccc;strokeColor=#cc0000" vertex="1" parent="20">
          <mxGeometry x="1580" y="40" width="240" height="50" as="geometry"/>
        </mxCell>

        <!-- Notes -->
        <mxCell id="70" value="Notes:\n- ALB terminates TLS (ACM); optionally CloudFront fronting ALB.\n- ECS tasks in private subnets use NAT GW for egress to OpenAI/Astra.\n- Secrets via Secrets Manager; configs via SSM.\n- Artifacts: Option A EFS mount (compatible with current local paths).\n  Option B S3 bucket with sync job/sidecar.\n- auth.db (SQLite) on EFS now; future: migrate to RDS." style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=12" vertex="1" parent="20">
          <mxGeometry x="880" y="880" width="680" height="160" as="geometry"/>
        </mxCell>

        <!-- Edges: Internet to CloudFront/WAF to ALB -->
        <mxCell id="200" edge="1" parent="1" source="10" target="11" style="endArrow=block;html=1;"/>
        <mxCell id="201" edge="1" parent="1" source="11" target="30" style="endArrow=block;html=1;"/>
        <mxCell id="202" edge="1" parent="1" source="12" target="11" style="endArrow=none;dashed=1;html=1;"/>
        <mxCell id="203" edge="1" parent="1" source="12" target="30" style="endArrow=none;dashed=1;html=1;"/>

        <!-- ALB to ECS services (path-based) -->
        <mxCell id="210" edge="1" parent="1" source="30" target="40" style="endArrow=block;html=1;labelBackgroundColor=#ffffff" value="/rag/*, /api/*"/>
        <mxCell id="211" edge="1" parent="1" source="30" target="41" style="endArrow=block;html=1;labelBackgroundColor=#ffffff" value="/ (user UI)"/>
        <mxCell id="212" edge="1" parent="1" source="30" target="42" style="endArrow=block;html=1;labelBackgroundColor=#ffffff" value="/admin/*"/>
        <mxCell id="213" edge="1" parent="1" source="30" target="43" style="endArrow=block;html=1;labelBackgroundColor=#ffffff" value="/feedback/*"/>
        <mxCell id="214" edge="1" parent="1" source="30" target="44" style="endArrow=block;html=1;labelBackgroundColor=#ffffff" value="/requirements/*"/>

        <!-- ECS tasks to shared services -->
        <mxCell id="220" edge="1" parent="1" source="40" target="50" style="endArrow=block;html=1;"/>
        <mxCell id="221" edge="1" parent="1" source="41" target="50" style="endArrow=block;html=1;"/>
        <mxCell id="222" edge="1" parent="1" source="42" target="50" style="endArrow=block;html=1;"/>
        <mxCell id="223" edge="1" parent="1" source="43" target="50" style="endArrow=block;html=1;"/>
        <mxCell id="224" edge="1" parent="1" source="44" target="50" style="endArrow=block;html=1;"/>

        <mxCell id="225" edge="1" parent="1" source="40" target="51" style="endArrow=block;html=1;dashed=1;"/>
        <mxCell id="226" edge="1" parent="1" source="41" target="51" style="endArrow=block;html=1;dashed=1;"/>
        <mxCell id="227" edge="1" parent="1" source="42" target="51" style="endArrow=block;html=1;dashed=1;"/>
        <mxCell id="228" edge="1" parent="1" source="43" target="51" style="endArrow=block;html=1;dashed=1;"/>
        <mxCell id="229" edge="1" parent="1" source="44" target="51" style="endArrow=block;html=1;dashed=1;"/>

        <mxCell id="230" edge="1" parent="1" source="40" target="52" style="endArrow=block;html=1;dashed=1;"/>
        <mxCell id="231" edge="1" parent="1" source="41" target="52" style="endArrow=block;html=1;dashed=1;"/>
        <mxCell id="232" edge="1" parent="1" source="42" target="52" style="endArrow=block;html=1;dashed=1;"/>
        <mxCell id="233" edge="1" parent="1" source="43" target="52" style="endArrow=block;html=1;dashed=1;"/>
        <mxCell id="234" edge="1" parent="1" source="44" target="52" style="endArrow=block;html=1;dashed=1;"/>

        <!-- ECS tasks to storage options -->
        <mxCell id="235" edge="1" parent="1" source="40" target="53" style="endArrow=block;html=1;"/>
        <mxCell id="236" edge="1" parent="1" source="41" target="53" style="endArrow=block;html=1;"/>
        <mxCell id="237" edge="1" parent="1" source="42" target="53" style="endArrow=block;html=1;"/>
        <mxCell id="238" edge="1" parent="1" source="43" target="53" style="endArrow=block;html=1;"/>
        <mxCell id="239" edge="1" parent="1" source="44" target="53" style="endArrow=block;html=1;"/>

        <mxCell id="240" edge="1" parent="1" source="40" target="54" style="endArrow=block;html=1;dashed=1;"/>
        <mxCell id="241" edge="1" parent="1" source="43" target="54" style="endArrow=block;html=1;dashed=1;"/>
        <mxCell id="242" edge="1" parent="1" source="41" target="55" style="endArrow=block;html=1;dashed=1;"/>

        <!-- ECS tasks egress via NAT to external services -->
        <mxCell id="250" edge="1" parent="1" source="41" target="31" style="endArrow=block;html=1;dashed=1;"/>
        <mxCell id="251" edge="1" parent="1" source="40" target="31" style="endArrow=block;html=1;dashed=1;"/>
        <mxCell id="252" edge="1" parent="1" source="42" target="31" style="endArrow=block;html=1;dashed=1;"/>
        <mxCell id="253" edge="1" parent="1" source="43" target="31" style="endArrow=block;html=1;dashed=1;"/>
        <mxCell id="254" edge="1" parent="1" source="44" target="31" style="endArrow=block;html=1;dashed=1;"/>

        <mxCell id="255" edge="1" parent="1" source="31" target="60" style="endArrow=block;html=1;"/>
        <mxCell id="256" edge="1" parent="1" source="31" target="61" style="endArrow=block;html=1;"/>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>

