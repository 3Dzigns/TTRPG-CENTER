# BUG-026: Harden requirements (HF, OCR, parsing) and pin a 1024-d embedder


## Summary
`requirements.txt` is missing several packages and pins for stable ingestion, embeddings, and graph steps (unstructured, OCR wrappers, HF, etc.).

## Impact
Environment drift and missing components cause intermittent failures.

## Fix
Augment `requirements.txt` with explicit, pinned dependencies and notes on system packages.

### Python packages (add/pin)
```
astrapy>=1.3.0
httpx>=0.27.0
python-dotenv>=1.0.1

# Parsing / OCR
unstructured[local-inference,pdf]>=0.15.0
pymupdf>=1.24.3
pdfminer.six>=20231228
pypdf>=4.2.0
pytesseract>=0.3.10
Pillow>=10.3.0

# Embeddings / HF
sentence-transformers>=3.0.1
transformers>=4.43.0
accelerate>=0.33.0
safetensors>=0.4.3
huggingface-hub>=0.24.5
tokenizers>=0.19.1
numpy>=1.26.4
scikit-learn>=1.4.2

# Graph / Utils
networkx>=3.3
pydantic>=2.7.0
fastapi>=0.112.0
uvicorn[standard]>=0.30.0
```

### System packages (documented, not pip-installed)
- **Poppler**: provides `pdfinfo`, `pdftoppm` (install via OS/Conda).
- **Tesseract OCR**: binary + language packs (install via OS/Conda).

### Model notes
- Choose a **1024-d** sentence-transformer (or project to 1024). Examples:
  - `intfloat/e5-large-unsupervised` (1024-d)
  - Or use any 768-d model with an additional projection layer to 1024 before insert.
- Pin model names/versions in a config file checked into repo.

## Acceptance Criteria (User Stories)
**US-026A (DevOps)**: As DevOps, a clean `pip install -r requirements.txt` on Python 3.12 succeeds.
**US-026B (Dev)**: As a developer, `ingest:preflight` confirms HF model, tokenizer, and embed dim = 1024.

## Test Cases
**Unit**
- Import tests for all packages.
- Config test asserts `embedder_dim==1024`.

**Functional**
- Cold start in a fresh venv â†’ preflight passes; small ingestion run succeeds.
