# BUG-005: Admin dashboard lacks live DB metrics (dictionary/chunk counts & sources)

## Summary
Dashboard does not display **database-derived** metrics: number of dictionary entries, number of chunks, and list of available sources. Current cards show placeholders and do not query the DB.

## Expected
- A **DB Metrics** panel shows:
  - `dictionary_count`
  - `chunk_count`
  - `sources` (distinct source_ids with per-source counts)
- Data must come from **live DB queries** (Astra/AstraGraph/etc.), not local logs.

## Actual
- No such panel; values absent.

## Impact
- Operators cannot verify ingestion coverage or diagnose discrepancies (e.g., dictionary >> chunks).

## Proposed Fix
1. **Backend endpoint**
   - `GET /admin/api/db/metrics` returns:
     ```json
     {
       "dictionary_count": 12345,
       "chunk_count": 67890,
       "sources": [
         {"source_id":"CRB_PF2e_v1","chunks": 11234, "updated_at":"2025-09-08T11:10:00Z"},
         {"source_id":"UltimateMagic_v1","chunks": 9876, "updated_at":"2025-09-08T10:50:00Z"}
       ]
     }
     ```
   - Implement via DB client queries:
     - `SELECT COUNT(*) FROM ttrpg_dictionary`
     - `SELECT COUNT(*) FROM ttrpg_chunks`
     - `SELECT source_id, COUNT(*) as chunks, MAX(updated_at) FROM ttrpg_chunks GROUP BY source_id ORDER BY chunks DESC`
2. **Frontend card**
   - “Database Overview”: large numbers for dictionary & chunks; table of sources.
   - Refresh button fetches endpoint; integrates with auto-refresh cadence from BUG‑004.

## Acceptance Criteria
- Panel renders the three metrics from DB within ≤1s p95 for ≤50 sources.
- Counts update within a minute after an ingestion run completes.
- If DB is unavailable, panel shows a clear error and a retry button.

## Automated Tests
- **Unit (backend):** DB client adapters return correct counts; SQL/queries parameterized and safe.
- **Functional:** With a seeded test DB, endpoint returns expected JSON; frontend renders counts and sources table.
- **Security:** Endpoint requires admin role; rate-limited to prevent abuse.
